<!DOCTYPE html>
<html lang="vi" class="antialiased">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ph√≤ng thi ·∫£o IQO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        const SECURE_VAULT = {
            _salt: "iqo_secret_salt_2024",
            _ledger: {
                zero: ["5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8"], // V√≠ d·ª• m√£ hash c·ªßa 'password'
                pro: []
            }
        };
    </script>

    <script src="data.js" onerror="console.warn('C·∫£nh b√°o: Kh√¥ng t√¨m th·∫•y data.js, ƒëang s·ª≠ d·ª•ng d·ªØ li·ªáu m·∫´u.')"></script>

    <style>
        :root {
            --bg: #f5f5f7; --card: #ffffff; --text: #1d1d1f; --sub: #86868b;
            --accent: #0071e3; --success: #34c759; --danger: #ff3b30;
            --glass: rgba(255, 255, 255, 0.85);
            --font-main: 'Inter', system-ui, -apple-system, sans-serif;
        }
        .dark {
            --bg: #000000; --card: #1c1c1e; --text: #f5f5f7; --sub: #98989d;
            --accent: #0a84ff; --glass: rgba(28, 28, 30, 0.85);
        }
        body { font-family: var(--font-main); background: var(--bg); color: var(--text); transition: background 0.3s ease; }
        .glass-panel { background: var(--glass); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(128,128,128,0.1); }
        .option-row.selected { background: rgba(0,113,227,0.1); border-color: var(--accent); }
        .option-row.strike { opacity: 0.3; text-decoration: line-through; pointer-events: none; }
        #toast-box { position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-200%); z-index: 1000; transition: 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28); }
        #toast-box.show { transform: translateX(-50%) translateY(0); }
        .focus-mode .sidebar, .focus-mode header { display: none !important; }
    </style>
</head>

<body class="flex flex-col md:flex-row h-screen overflow-hidden">

    <div id="toast-box" class="bg-black text-white px-6 py-2 rounded-full text-sm font-medium shadow-2xl">Th√¥ng b√°o</div>

    <div id="key-modal" class="fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm hidden">
        <div class="glass-panel w-[90%] max-w-sm rounded-3xl p-8 text-center">
            <h3 class="text-xl font-bold mb-2">üõ°Ô∏è IQO SHIELD</h3>
            <p class="text-xs text-[var(--sub)] mb-6">Nh·∫≠p m√£ k√≠ch ho·∫°t ƒë·ªÉ m·ªü kh√≥a to√†n b·ªô t√≠nh nƒÉng</p>
            <input type="text" id="key-input" placeholder="Nh·∫≠p Key t·∫°i ƒë√¢y..." class="w-full p-4 rounded-xl bg-gray-100 dark:bg-gray-800 mb-4 text-center font-mono focus:ring-2 focus:ring-blue-500 outline-none">
            <button onclick="verifyKey()" id="verify-btn" class="w-full py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition-all">X√ÅC TH·ª∞C</button>
            <button onclick="useFree()" class="mt-4 text-xs text-[var(--sub)] underline">Ti·∫øp t·ª•c d√πng mi·ªÖn ph√≠</button>
        </div>
    </div>

    <aside class="sidebar w-full md:w-[280px] glass-panel flex flex-col z-40 h-16 md:h-full fixed md:relative bottom-0 md:top-0 order-2 md:order-1">
        <div class="hidden md:flex p-6 flex-col gap-4">
            <div class="flex gap-2">
                <div onclick="resetApp()" class="w-3 h-3 rounded-full bg-red-500 cursor-pointer"></div>
                <div onclick="toggleDarkMode()" class="w-3 h-3 rounded-full bg-yellow-500 cursor-pointer"></div>
                <div onclick="toggleFocusMode()" class="w-3 h-3 rounded-full bg-green-500 cursor-pointer"></div>
            </div>
            <div class="mt-4">
                <h1 class="font-black text-xl tracking-tighter">IQO ULTRA</h1>
                <div id="user-tier-display" class="text-[10px] font-bold opacity-50 uppercase">FREE TIER</div>
            </div>
        </div>
        <nav id="nav-list" class="flex-1 overflow-x-auto md:overflow-y-auto flex md:flex-col p-2 gap-1"></nav>
    </aside>

    <main class="flex-1 flex flex-col h-full overflow-hidden order-1 md:order-2">
        <header class="h-14 glass-panel flex items-center justify-between px-6 shrink-0">
            <h2 id="page-title" class="font-bold truncate">ƒêang t·∫£i...</h2>
            <div class="flex items-center gap-3">
                <div id="cheating-warning" class="hidden text-[10px] bg-red-500 text-white px-2 py-1 rounded-md animate-pulse">CH·ªêNG GIAN L·∫¨N</div>
                <div id="timer" class="hidden font-mono font-bold bg-black text-white px-3 py-1 rounded-md">00:00</div>
                <button onclick="submitExam()" id="submit-btn" class="hidden px-4 py-1.5 bg-green-600 text-white rounded-full text-xs font-bold hover:bg-green-700">N·ªòP B√ÄI</button>
            </div>
        </header>

        <div class="h-1 w-full bg-gray-200"><div id="progress-bar" class="h-full bg-blue-600 w-0 transition-all duration-500"></div></div>

        <div id="content-area" class="flex-1 overflow-y-auto p-4 md:p-10 pb-32">
            </div>
    </main>

<script>
const $ = s => document.querySelector(s);
let STATE = { tier: 'free', exam: null, answers: {}, timer: null, time: 0, cheatCount: 0 };

// Gi·∫£ l·∫≠p EXAM_DATA n·∫øu file data.js b·ªã l·ªói
if (typeof EXAM_DATA === 'undefined') {
    window.EXAM_DATA = [{
        id: 'demo-1', title: 'ƒê·ªÅ m·∫´u IQ', category: 'IQ', subtitle: 'Ki·ªÉm tra t∆∞ duy logic', time: 10,
        questions: [{type: 'choice', text: '1 + 1 = ?', options: ['1','2','3','4'], correct: 1, explanation: 'To√°n h·ªçc c∆° b·∫£n.'}]
    }];
}

// --- CORE FUNCTIONS ---
const QuantumGuard = {
    async hash(key) {
        const msgBuffer = new TextEncoder().encode(key + SECURE_VAULT._salt);
        const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
        return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
    }
};

const verifyKey = async () => {
    const input = $('#key-input').value.trim();
    if (!input) return;
    $('#verify-btn').innerText = "ƒêANG KI·ªÇM TRA...";
    const h = await QuantumGuard.hash(input);
    
    if (SECURE_VAULT._ledger.zero.includes(h)) activateTier('zero', "ƒê√£ k√≠ch ho·∫°t ch·∫ø ƒë·ªô GOD MODE");
    else if (SECURE_VAULT._ledger.pro.includes(h)) activateTier('pro', "ƒê√£ k√≠ch ho·∫°t b·∫£n PRO");
    else { alert('Sai m√£ k√≠ch ho·∫°t!'); $('#verify-btn').innerText = "X√ÅC TH·ª∞C"; }
};

const activateTier = (t, msg) => {
    STATE.tier = t;
    localStorage.setItem('iqo_tier', btoa(t));
    $('#key-modal').classList.add('hidden');
    showToast(msg);
    updateUI();
};

const useFree = () => { $('#key-modal').classList.add('hidden'); showToast("S·ª≠ d·ª•ng b·∫£n gi·ªõi h·∫°n"); };

const updateUI = () => {
    $('#user-tier-display').innerText = STATE.tier + " tier";
    renderDashboard();
    renderNav();
};

const renderDashboard = () => {
    $('#page-title').innerText = "Th∆∞ vi·ªán";
    $('#content-area').innerHTML = `
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            ${EXAM_DATA.map(e => `
                <div onclick="startExam('${e.id}')" class="glass-panel p-6 rounded-2xl cursor-pointer hover:scale-[1.02] transition-transform">
                    <span class="text-[10px] bg-blue-100 text-blue-700 px-2 py-1 rounded font-bold">${e.category}</span>
                    <h3 class="text-lg font-bold mt-2">${e.title}</h3>
                    <p class="text-sm text-gray-500">${e.subtitle}</p>
                </div>
            `).join('')}
        </div>`;
};

const renderNav = () => {
    $('#nav-list').innerHTML = EXAM_DATA.map(e => `
        <div onclick="startExam('${e.id}')" class="min-w-fit p-3 md:w-full rounded-xl cursor-pointer hover:bg-blue-50 flex items-center gap-3">
            <div class="w-8 h-8 rounded bg-blue-600 text-white flex items-center justify-center font-bold text-xs">${e.title[0]}</div>
            <span class="hidden md:block text-sm font-medium">${e.title}</span>
        </div>
    `).join('');
};

const startExam = (id) => {
    const exam = EXAM_DATA.find(e => e.id === id);
    if (!exam) return;
    STATE.exam = exam;
    STATE.answers = {};
    STATE.time = exam.time * 60;
    
    $('#page-title').innerText = exam.title;
    $('#timer').classList.remove('hidden');
    $('#submit-btn').classList.remove('hidden');
    
    renderQuestions();
    startTimer();
};

const renderQuestions = () => {
    let html = `<div class="max-w-3xl mx-auto space-y-8">`;
    STATE.exam.questions.forEach((q, i) => {
        html += `
        <div class="glass-panel p-6 rounded-3xl" id="q-box-${i}">
            <p class="font-bold mb-4 text-blue-600">C√¢u ${i+1}</p>
            <p class="text-lg mb-6">${q.text}</p>
            <div class="space-y-3">
                ${q.options.map((opt, oi) => `
                    <div onclick="selectAns(${i}, ${oi}, this)" class="option-row p-4 border-2 rounded-2xl cursor-pointer transition-all flex items-center gap-4">
                        <div class="w-6 h-6 rounded-full border flex items-center justify-center text-xs font-bold">${String.fromCharCode(65+oi)}</div>
                        <span>${opt}</span>
                    </div>
                `).join('')}
            </div>
        </div>`;
    });
    html += `</div>`;
    $('#content-area').innerHTML = html;
};

const selectAns = (qi, oi, el) => {
    STATE.answers[qi] = oi;
    const parent = el.parentElement;
    Array.from(parent.children).forEach(child => child.classList.remove('selected'));
    el.classList.add('selected');
    updateProgress();
};

const updateProgress = () => {
    const done = Object.keys(STATE.answers).length;
    const total = STATE.exam.questions.length;
    $('#progress-bar').style.width = `${(done/total)*100}%`;
};

const startTimer = () => {
    if (STATE.timer) clearInterval(STATE.timer);
    STATE.timer = setInterval(() => {
        STATE.time--;
        const m = Math.floor(STATE.time / 60);
        const s = STATE.time % 60;
        $('#timer').innerText = `${m}:${s < 10 ? '0' + s : s}`;
        if (STATE.time <= 0) submitExam();
    }, 1000);
};

const submitExam = () => {
    clearInterval(STATE.timer);
    let score = 0;
    STATE.exam.questions.forEach((q, i) => {
        const isCorrect = STATE.answers[i] === q.correct;
        if (isCorrect) score++;
        const box = $(`#q-box-${i}`);
        box.style.borderColor = isCorrect ? 'var(--success)' : 'var(--danger)';
        
        // Hi·ªán gi·∫£i th√≠ch n·∫øu kh√¥ng ph·∫£i b·∫£n free
        if(STATE.tier !== 'free') {
            const expl = document.createElement('div');
            expl.className = "mt-4 p-4 bg-gray-50 rounded-xl text-sm italic";
            expl.innerHTML = `<b>Gi·∫£i th√≠ch:</b> ${q.explanation}`;
            box.appendChild(expl);
        }
    });
    alert(`Ho√†n th√†nh! ƒêi·ªÉm c·ªßa b·∫°n: ${score}/${STATE.exam.questions.length}`);
};

const showToast = (m) => {
    const t = $('#toast-box');
    t.innerText = m;
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 3000);
};

const toggleDarkMode = () => document.documentElement.classList.toggle('dark');
const toggleFocusMode = () => document.body.classList.toggle('focus-mode');
const resetApp = () => { if(confirm('X√≥a d·ªØ li·ªáu v√† l√†m l·∫°i t·ª´ ƒë·∫ßu?')) { localStorage.clear(); location.reload(); } };

// --- INITIALIZE ---
window.onload = () => {
    try {
        const saved = localStorage.getItem('iqo_tier');
        if (saved) STATE.tier = atob(saved);
    } catch(e) {}
    
    if (STATE.tier === 'free') {
        $('#key-modal').classList.remove('hidden');
    }
    updateUI();
};

document.addEventListener("visibilitychange", () => {
    if (document.hidden && STATE.exam) {
        STATE.cheatCount++;
        $('#cheating-warning').innerText = `‚ö†Ô∏è C·∫¢NH B√ÅO (${STATE.cheatCount})`;
        $('#cheating-warning').classList.remove('hidden');
    }
});
</script>
</body>
</html>
