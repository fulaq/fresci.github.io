<!DOCTYPE html>
<html lang="vi" class="antialiased">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Ph√≤ng thi ·∫£o IQO</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#f5f5f7">
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
<!-- Import Data v·ªõi x·ª≠ l√Ω l·ªói -->
<script src="data.js" onerror="alert('L·ªñI: Kh√¥ng t√¨m th·∫•y file data.js! H√£y ƒë·∫£m b·∫£o file n√†y n·∫±m c√πng th∆∞ m·ª•c v·ªõi index.html')"></script>

<style>
    :root {
        --bg: #f5f5f7; --card: #ffffff; --text: #1d1d1f; --sub: #86868b;
        --accent: #0071e3; --success: #34c759; --danger: #ff3b30; --gold: #F5A623;
        --glass: rgba(255, 255, 255, 0.85);
        --font-main: 'Inter', system-ui, -apple-system, sans-serif;
    }
    .dark {
        --bg: #000000; --card: #1c1c1e; --text: #f5f5f7; --sub: #98989d;
        --accent: #0a84ff; --glass: rgba(28, 28, 30, 0.85);
    }
    
    body { font-family: var(--font-main); background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; -webkit-tap-highlight-color: transparent; transition: background 0.3s ease; user-select: none; }
    
    /* Styles */
    .glass-panel { background: var(--glass); backdrop-filter: blur(25px) saturate(180%); -webkit-backdrop-filter: blur(25px) saturate(180%); border: 1px solid rgba(128,128,128,0.1); box-shadow: 0 4px 24px rgba(0,0,0,0.04); }
    .btn { transition: all 0.2s cubic-bezier(0.25,1,0.5,1); cursor: pointer; }
    .btn:active { transform: scale(0.96); }
    .option-row { transition: 0.2s; border: 1.5px solid transparent; }
    .option-row:hover { background: rgba(128,128,128,0.05); }
    .option-row.selected { background: rgba(0,113,227,0.08); border-color: var(--accent); }
    .option-row.strike { opacity: 0.4; text-decoration: line-through; filter: grayscale(1); pointer-events: none; }
    
    /* Anti-Cheat & Features */
    .focus-mode .sidebar, .focus-mode header { display: none !important; }
    .focus-mode #content-area { padding: 40px !important; max-width: 800px; margin: 0 auto; }
    #toast-box { position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-150%); background: rgba(0,0,0,0.8); color: white; padding: 10px 24px; border-radius: 50px; font-size: 13px; font-weight: 600; z-index: 100; transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); backdrop-filter: blur(10px); display: flex; align-items: center; gap: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
    #toast-box.show { transform: translateX(-50%) translateY(0); }
    
    /* Animations */
    @keyframes slideUp { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }
    @keyframes confetti { 0% { transform: translateY(0) rotateZ(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotateZ(720deg); opacity: 0; } }
    .enter { animation: slideUp 0.4s ease-out forwards; }
    .block-img { max-width: 100%; border-radius: 8px; margin: 10px 0; border: 1px solid rgba(128,128,128,0.2); }
    .inline-img { display: inline-block; vertical-align: middle; max-height: 20px; }
</style>
</head>
<body class="flex flex-col md:flex-row h-screen overflow-hidden">

    <!-- Toast & Effects -->
    <div id="toast-box">System Ready</div>
    <div id="confetti-container" class="fixed inset-0 pointer-events-none z-[100] hidden"></div>

    <!-- Security Modal -->
    <div id="key-modal" class="fixed inset-0 z-[80] flex items-center justify-center bg-black/60 backdrop-blur-xl hidden">
        <div class="glass-panel w-[90%] max-w-sm rounded-3xl p-8 shadow-2xl scale-100 enter text-center relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500"></div>
            <div class="w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-full mx-auto mb-4 flex items-center justify-center text-3xl shadow-inner">üõ°Ô∏è</div>
            <h3 class="text-xl font-bold mb-1">IQO QUANTUM SHIELD</h3>
            <p class="text-xs text-[var(--sub)] mb-6">Nh·∫≠p m√£ k√≠ch ho·∫°t (Zero/Pro) ho·∫∑c d√πng th·ª≠</p>
            <input type="text" id="key-input" placeholder="XXXX-XXXX-XXXX" class="w-full p-4 rounded-xl bg-[rgba(128,128,128,0.08)] text-center font-mono text-sm uppercase mb-4 focus:outline-none focus:ring-2 focus:ring-[var(--accent)] transition-all">
            <button onclick="verifyKey()" id="verify-btn" class="w-full py-3.5 rounded-xl bg-[var(--text)] text-[var(--bg)] font-bold btn mb-3 shadow-lg">X√ÅC TH·ª∞C KEY</button>
            <button onclick="useFree()" class="text-xs text-[var(--sub)] hover:text-[var(--text)] underline decoration-dotted">Ti·∫øp t·ª•c b·∫£n Mi·ªÖn ph√≠</button>
        </div>
    </div>

    <!-- Sidebar -->
    <aside class="sidebar w-full md:w-[280px] glass-panel border-r-0 md:border-r flex flex-col z-40 shrink-0 h-16 md:h-full fixed md:relative bottom-0 md:bottom-auto order-2 md:order-1 transition-all">
        <div class="h-16 hidden md:flex items-center px-6 gap-3 select-none">
            <div class="flex gap-1.5 absolute top-4 left-4">
                <div class="w-3 h-3 rounded-full bg-[#FF5F57] cursor-pointer" onclick="resetApp()" title="Reset"></div>
                <div class="w-3 h-3 rounded-full bg-[#FEBC2E] cursor-pointer" onclick="toggleDarkMode()" title="Dark Mode"></div>
                <div class="w-3 h-3 rounded-full bg-[#28C840] cursor-pointer" onclick="toggleFocusMode()" title="Zen Mode"></div>
            </div>
            <div class="ml-auto text-right">
                <div class="font-bold text-sm tracking-tight">IQO ULTRA</div>
                <div class="text-[10px] text-[var(--sub)]" id="user-tier-display">Loading...</div>
            </div>
        </div>
        
        <nav class="flex-1 overflow-y-auto p-2 space-y-1 flex md:block flex-row items-center justify-around md:justify-start" id="nav-list"></nav>
        
        <!-- Tools -->
        <div class="p-4 border-t border-[rgba(128,128,128,0.1)] hidden md:block">
            <div class="flex justify-between text-xs mb-2 text-[var(--sub)]"><span>Nh√°p nhanh</span><button onclick="clearScratchpad()" class="hover:text-red-500">X√≥a</button></div>
            <textarea id="scratchpad" class="w-full h-24 bg-[rgba(128,128,128,0.05)] rounded-lg p-2 text-xs resize-none focus:outline-none focus:ring-1 focus:ring-[var(--accent)]" placeholder="Ghi ch√∫..."></textarea>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col h-full relative overflow-hidden order-1 md:order-2 bg-[var(--bg)]">
        <!-- Header -->
        <header class="h-14 glass-panel border-b border-[rgba(128,128,128,0.1)] flex items-center justify-between px-6 shrink-0 z-30 transition-all">
            <div class="flex items-center gap-4">
                <h2 id="page-title" class="font-bold text-sm truncate max-w-[200px]">T·ªïng quan</h2>
                <div id="cheating-warning" class="hidden text-xs font-bold text-red-500 bg-red-100 px-2 py-1 rounded animate-pulse">‚ö†Ô∏è R·ªúI TAB PH√ÅT HI·ªÜN</div>
            </div>
            <div class="flex items-center gap-3">
                <div id="timer" class="hidden font-mono text-sm font-bold bg-[var(--accent)] text-white px-3 py-1 rounded-md shadow-lg">00:00</div>
                <button onclick="submitExam()" id="submit-btn" class="hidden px-5 py-1.5 bg-[var(--success)] text-white rounded-full text-xs font-bold btn shadow-lg">N·ªòP B√ÄI</button>
                <button onclick="toggleKeyModal()" class="w-8 h-8 rounded-full bg-[rgba(128,128,128,0.1)] flex items-center justify-center btn"><svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg></button>
            </div>
        </header>

        <!-- Progress -->
        <div class="h-1 w-full bg-[rgba(128,128,128,0.1)]"><div id="progress-bar" class="h-full bg-[var(--accent)] w-0 transition-all duration-300"></div></div>

        <!-- Viewport -->
        <div id="content-area" class="flex-1 overflow-y-auto p-4 md:p-8 scroll-smooth pb-24 md:pb-8 relative"></div>
        
        <!-- Explanation Overlay -->
        <div id="expl-modal" class="absolute inset-0 bg-[var(--bg)] z-50 transform translate-y-full transition-transform duration-300 flex flex-col glass-panel">
            <div class="h-14 border-b flex items-center justify-between px-6 shrink-0 bg-[var(--glass)]">
                <h3 class="font-bold text-[var(--accent)]">L·ªùi gi·∫£i chi ti·∫øt</h3>
                <button onclick="closeExpl()" class="w-8 h-8 rounded-full bg-[rgba(128,128,128,0.1)] flex items-center justify-center">‚úï</button>
            </div>
            <div class="flex-1 overflow-y-auto p-6 md:p-10" id="expl-content"></div>
        </div>
    </main>

<script>
// --- GLOBAL STATE ---
const $ = s => document.querySelector(s);
let STATE = { tier: 'free', exam: null, answers: {}, timer: null, time: 0, cheatCount: 0 };

// --- SECURITY CORE (QuantumGuard) ---
const QuantumGuard = {
    _str2buf: (str) => new TextEncoder().encode(str),
    _buf2hex: (buf) => Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2, '0')).join(''),
    async hash(key) {
        if(!window.crypto || !window.crypto.subtle) return "err";
        const salt = this._str2buf(SECURE_VAULT._salt);
        const keyMaterial = await crypto.subtle.importKey("raw", this._str2buf(key), { name: "PBKDF2" }, false, ["deriveBits", "deriveKey"]);
        const derivedKey = await crypto.subtle.deriveKey({ name: "PBKDF2", salt: salt, iterations: 100000, hash: "SHA-256" }, keyMaterial, { name: "AES-GCM", length: 256 }, true, ["encrypt", "decrypt"]);
        return this._buf2hex(await crypto.subtle.exportKey("raw", derivedKey));
    }
};

const verifyKey = async () => {
    const input = $('#key-input').value.trim();
    if (!input) return useFree();
    $('#verify-btn').innerText = "ƒêANG GI·∫¢I M√É...";
    try {
        const h = await QuantumGuard.hash(input);
        if (SECURE_VAULT._ledger.zero.includes(h)) activateTier('zero', "üîì ZERO GOD MODE");
        else if (SECURE_VAULT._ledger.pro.includes(h)) activateTier('pro', "üîì PRO ACTIVATED");
        else { await new Promise(r=>setTimeout(r,1000)); alert('M√£ sai!'); }
    } catch(e) { alert('L·ªói b·∫£o m·∫≠t!'); } 
    finally { $('#verify-btn').innerText = "X√ÅC TH·ª∞C KEY"; }
};

const useFree = () => activateTier('free', "D√πng b·∫£n Mi·ªÖn ph√≠");
const activateTier = (t, msg) => { STATE.tier = t; localStorage.setItem('iqo_tk', btoa(t)); $('#key-modal').classList.add('hidden'); showToast(msg); updateUI(); initApp(); };
const restoreSession = () => { try { const t = atob(localStorage.getItem('iqo_tk')); STATE.tier = ['zero','pro'].includes(t)?t:'free'; } catch(e){ STATE.tier='free'; } };

// --- APP LOGIC ---
const initApp = () => {
    if(typeof EXAM_DATA === 'undefined') { alert('L·ªói d·ªØ li·ªáu! Ki·ªÉm tra data.js'); return; }
    renderDashboard();
    renderNav();
    loadScratchpad();
    // Anti-cheat
    document.addEventListener("visibilitychange", () => {
        if(document.hidden && STATE.exam) {
            STATE.cheatCount++;
            $('#cheating-warning').innerText = `‚ö†Ô∏è R·ªúI TAB (${STATE.cheatCount})`;
            $('#cheating-warning').classList.remove('hidden');
        }
    });
};

const updateUI = () => {
    $('#user-tier-display').innerHTML = `<span class="tier-badge tier-${STATE.tier}">${STATE.tier.toUpperCase()}</span>`;
    if(STATE.tier === 'free') $('#key-modal').classList.remove('hidden');
};

const renderDashboard = () => {
    $('#page-title').innerText = "Th∆∞ vi·ªán ƒë·ªÅ thi";
    $('#timer').classList.add('hidden'); $('#submit-btn').classList.add('hidden'); $('#cheating-warning').classList.add('hidden');
    $('#content-area').innerHTML = `
        <div class="max-w-5xl mx-auto enter">
            <h1 class="text-2xl font-bold mb-6">Th∆∞ vi·ªán ƒë·ªÅ thi (${STATE.tier.toUpperCase()})</h1>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
                ${EXAM_DATA.map(e => `
                    <div onclick="startExam('${e.id}')" class="glass-panel p-6 rounded-2xl cursor-pointer hover:-translate-y-1 transition-all group border-t-4 ${e.id.includes('hoa')?'border-blue-500':'border-purple-500'}">
                        <span class="text-[10px] font-bold uppercase tracking-wider px-2 py-1 rounded bg-black/5">${e.category}</span>
                        <h3 class="text-lg font-bold mt-3 mb-1">${e.title}</h3>
                        <p class="text-xs text-[var(--sub)]">${e.subtitle}</p>
                    </div>
                `).join('')}
            </div>
        </div>`;
};

const renderNav = () => {
    $('#nav-list').innerHTML = EXAM_DATA.map(e => `
        <div onclick="startExam('${e.id}')" class="p-3 rounded-xl cursor-pointer hover:bg-black/5 flex items-center gap-3 transition-all">
            <div class="w-8 h-8 rounded-lg flex items-center justify-center font-bold text-xs ${e.id.includes('hoa')?'bg-blue-100 text-blue-600':'bg-purple-100 text-purple-600'}">${e.title[0]}</div>
            <div class="hidden md:block truncate w-32 text-xs font-bold">${e.title}</div>
        </div>`).join('');
};

const startExam = (id) => {
    STATE.exam = EXAM_DATA.find(e => e.id === id);
    STATE.answers = {}; STATE.cheatCount = 0; STATE.time = STATE.exam.time * 60;
    
    $('#page-title').innerText = STATE.exam.title;
    $('#timer').classList.remove('hidden'); $('#submit-btn').classList.remove('hidden');
    
    renderQuestions(); startTimer(); showToast(`üèÅ B·∫Øt ƒë·∫ßu: ${STATE.exam.title}`);
};

const renderQuestions = () => {
    const qHTML = STATE.exam.questions.map((q, i) => `
        <div class="glass-panel p-6 rounded-3xl mb-6 relative" id="q-${i}">
            <div class="flex justify-between mb-4">
                <span class="w-8 h-8 rounded-full bg-black/5 flex items-center justify-center text-xs font-bold">${i+1}</span>
                ${STATE.tier === 'zero' ? `<button onclick="showExpl(${i})" class="text-[10px] font-bold text-[var(--accent)] hover:underline">XEM L·ªúI GI·∫¢I</button>` : ''}
            </div>
            <div class="text-[15px] font-medium mb-4 leading-relaxed">${q.text}</div>
            <div class="grid gap-3">
                ${q.type === 'choice' ? q.options.map((opt, oid) => `
                    <div id="opt-${i}-${oid}" onclick="selectAns(${i}, ${oid}, this)" oncontextmenu="toggleStrike(event, this)" class="option-row p-3 rounded-xl cursor-pointer flex items-center gap-3 group">
                        <div class="w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center text-[10px] font-bold opt-idx group-hover:border-[var(--accent)]">${String.fromCharCode(65+oid)}</div>
                        <div class="text-sm select-none">${opt}</div>
                    </div>`).join('') 
                : `<input onchange="inputAns(${i}, this.value)" type="text" placeholder="${q.placeholder}" class="w-full p-3 rounded-xl bg-black/5 outline-none focus:ring-2 focus:ring-[var(--accent)] text-sm">`}
            </div>
        </div>`).join('');
    $('#content-area').innerHTML = `<div class="max-w-3xl mx-auto">${qHTML}</div>`;
};

// --- INTERACTIONS ---
const selectAns = (q, o, el) => {
    if(el.classList.contains('strike')) return;
    STATE.answers[q] = o;
    Array.from(el.parentElement.children).forEach(c => {
        c.classList.remove('selected');
        c.querySelector('.opt-idx').className = 'w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center text-[10px] font-bold opt-idx group-hover:border-[var(--accent)]';
    });
    el.classList.add('selected');
    el.querySelector('.opt-idx').className = 'w-6 h-6 rounded-full border-2 border-[var(--accent)] bg-[var(--accent)] text-white flex items-center justify-center text-[10px] font-bold opt-idx';
    updateProgress();
};
const inputAns = (q, v) => { STATE.answers[q] = v; updateProgress(); };
const toggleStrike = (e, el) => { e.preventDefault(); el.classList.toggle('strike'); };
const updateProgress = () => { $('#progress-bar').style.width = `${(Object.keys(STATE.answers).length / STATE.exam.questions.length)*100}%`; };

// --- TIMER & SUBMIT ---
const startTimer = () => {
    if(STATE.timer) clearInterval(STATE.timer);
    STATE.timer = setInterval(() => {
        STATE.time--;
        const m=Math.floor(STATE.time/60), s=STATE.time%60;
        $('#timer').innerText = `${m}:${s<10?'0'+s:s}`;
        if(STATE.time<=0) submitExam();
    }, 1000);
};

const submitExam = () => {
    if(!confirm('N·ªôp b√†i?')) return;
    clearInterval(STATE.timer);
    let score = 0;
    STATE.exam.questions.forEach((q, i) => {
        let correct = false;
        if(q.type === 'choice') correct = (STATE.answers[i] === q.correct);
        else if(q.type === 'input') correct = (STATE.answers[i] && STATE.answers[i].toString() == q.correct.toString());
        if(correct) score++;
        const card = $(`#q-${i}`);
        card.style.borderLeft = `4px solid ${correct ? 'var(--success)' : 'var(--danger)'}`;
        if(STATE.tier !== 'free') {
            const div = document.createElement('div');
            div.className = "mt-4 p-4 rounded-xl bg-black/5 text-sm";
            div.innerHTML = `<b class="${correct?'text-green-600':'text-red-600'}">${correct?'ƒê√öNG':'SAI'}</b>. ${q.explanation}`;
            card.appendChild(div);
        }
    });
    if(score/STATE.exam.questions.length > 0.8) fireConfetti();
    alert(`K·∫øt qu·∫£: ${score}/${STATE.exam.questions.length}`);
    $('#submit-btn').classList.add('hidden');
};

// --- FEATURES ---
const showExpl = (i) => { $('#expl-content').innerHTML = STATE.exam.questions[i].explanation; $('#expl-modal').classList.remove('translate-y-full'); };
const closeExpl = () => $('#expl-modal').classList.add('translate-y-full');
const toggleDarkMode = () => { document.documentElement.classList.toggle('dark'); showToast("ƒê√£ ƒë·ªïi giao di·ªán"); };
const toggleFocusMode = () => { document.body.classList.toggle('focus-mode'); showToast("Zen Mode"); };
const fireConfetti = () => {
    const c = $('#confetti-container'); c.classList.remove('hidden');
    c.innerHTML = Array(30).fill(0).map(()=>`<div style="position:absolute;left:${Math.random()*100}vw;top:-10px;width:10px;height:10px;background:red;animation:confetti ${2+Math.random()}s linear infinite"></div>`).join('');
    setTimeout(()=>c.classList.add('hidden'), 5000);
};
const showToast = (m) => { const t=$('#toast-box'); t.innerText=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),3000); };
const toggleKeyModal = () => $('#key-modal').classList.remove('hidden');
const clearScratchpad = () => { $('#scratchpad').value = ''; localStorage.removeItem('iqo_sc'); };
const loadScratchpad = () => { const v=localStorage.getItem('iqo_sc'); if(v) $('#scratchpad').value=v; $('#scratchpad').addEventListener('input', e=>localStorage.setItem('iqo_sc',e.target.value)); };
const resetApp = () => { if(confirm('Reset?')) { localStorage.clear(); location.reload(); } };

// START
restoreSession();
if(STATE.tier !== 'free') $('#key-modal').classList.add('hidden');
</script>
</body>
</html>
